<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Agenda MKSaúde</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <style>
        /* Global Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        ul {
            list-style: none;
        }

        /* Header */
        header {
            background: #fff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        header .logo {
            height: 40px;
        }

        header .top-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Main Layout */
        .scheduler-container {
            display: flex;
            height: calc(100vh - 60px);
        }

        .sidebar {
            width: 280px;
            background: #fff;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 1px 0 4px rgba(0, 0, 0, 0.1);
        }

        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .right-panel {
            width: 300px;
            background: #fff;
            padding: 20px;
            box-shadow: -1px 0 4px rgba(0, 0, 0, 0.1);
        }

        /* Sidebar Calendar & Filters */
        .calendar {
            margin-bottom: 20px;
        }

        .calendar .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .calendar table {
            width: 100%;
            border-collapse: collapse;
        }

        .calendar td {
            width: 14.28%;
            height: 40px;
            text-align: center;
            cursor: pointer;
        }

        .calendar td.selected {
            background: #4caf50;
            color: #fff;
            border-radius: 4px;
        }

        .filter-group {
            margin-top: 15px;
        }

        .filter-group label {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 5px;
        }

        /* Main Scheduler */
        .schedule-list {
            padding: 20px;
        }

        .slot {
            background: #fff;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
        }

        .slot .time {
            width: 80px;
            padding: 15px;
            border-right: 1px solid #eee;
            font-weight: bold;
        }

        .slot .details {
            flex: 1;
            padding: 15px;
        }

        .slot.confirmed .time {
            background: #4caf50;
            color: #fff;
        }

        .slot.confirmed .details .status {
            background: #4caf50;
            color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
        }

        .slot .actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
            padding: 10px;
        }

        .slot .actions button {
            background: none;
            border: none;
            cursor: pointer;
        }

        /* Right Panel */
        .panel-title {
            font-weight: bold;
            margin-bottom: 15px;
        }

        .panel-group {
            margin-bottom: 15px;
        }

        .panel-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .panel-group select,
        .panel-group input {
            width: 100%;
            padding: 5px;
        }
    </style>
</head>

<body>
    <header>
        <img src="/images/logo.png" alt="Logo" class="logo" />
        <div class="top-controls">
            <button onclick="prevDay()">&lt;</button>
            <span th:text="${selectedDate}"></span>
            <button onclick="nextDay()">&gt;</button>
            <select id="topFilterConvenio" onchange="applyFilters()">
                <option value="">Todos os Convênios</option>
                <option th:each="c : ${convenios}" th:value="${c.id}" th:text="${c.nome}"></option>
            </select>
            <input type="text" placeholder="Pesquisar por nome" id="searchName" oninput="filterSlots()" />
        </div>
    </header>
    <div class="scheduler-container">
        <aside class="sidebar">
            <div class="calendar">
                <div class="month-nav">
                    <button onclick="prevMonth()">&lt;</button>
                    <span th:text="${currentMonth}"></span>
                    <button onclick="nextMonth()">&gt;</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Dom</th>
                            <th>Seg</th>
                            <th>Ter</th>
                            <th>Qua</th>
                            <th>Qui</th>
                            <th>Sex</th>
                            <th>Sáb</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="week : ${calendarWeeks}">
                            <td th:each="day : ${week}" th:text="${day.day}"
                                th:classappend="${day.selected} ? 'selected' : ''" onclick="selectDate('${day.date}')">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div>
                <input type="checkbox" id="showFreeOnly" onchange="toggleFreeOnly()" />
                <label for="showFreeOnly">Apenas Livres</label>
            </div>
            <div class="filter-group">
                <label for="filterConvenio">Convênio</label>
                <select id="filterConvenio" onchange="applyFilters()">
                    <option value="">Todos</option>
                    <option th:each="c : ${convenios}" th:value="${c.id}" th:text="${c.nome}"></option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filterEspecialidade">Especialidade</label>
                <select id="filterEspecialidade" onchange="applyFilters()">
                    <option value="">Todas as Especialidades</option>
                    <option th:each="e : ${especialidades}" th:value="${e.id}" th:text="${e.nome}"></option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filterProfissional">Profissional</label>
                <select name="medico" class="form-control">
                    <option value="" disabled selected>Selecione um médico</option>
                    <option th:each="m : ${doctors}" th:value="${m.id}" th:text="${m.fullName}"></option>
                </select>
            </div>
        </aside>
        <section class="main">
            <div class="schedule-list" id="scheduleList">
                <div class="slot" th:each="slot : ${slots}" th:classappend="${slot.confirmado} ? ' confirmed' : ''">
                    <div class="time" th:text="${slot.hora}"></div>
                    <div class="details">
                        <div class="status" th:text="${slot.confirmado} ? 'CONFIRMADO' : 'LIVRE'"></div>
                        <div><strong th:text="${slot.pacienteNome}"></strong></div>
                        <div th:text="${slot.especialidade}"></div>
                    </div>
                    <div class="actions">
                        <button title="Editar" th:onclick="|editSlot(${slot.id})|">
                            <i class="fa fa-edit"></i>
                        </button>
                        <button title="Cancelar" th:onclick="|cancelSlot(${slot.id})|">
                            <i class="fa fa-trash"></i>
                        </button>
                        <button title="Atender" th:onclick="|attendSlot(${slot.id})|">
                            <i class="fa fa-stethoscope"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>
        <aside class="right-panel">
            <div class="panel-title">Painel Senhas</div>
            <div class="panel-group">
                <label for="roomSelect">Sala</label>
                <select id="roomSelect">
                    <option th:each="s : ${salas}" th:value="${s.id}" th:text="${s.nome}"></option>
                </select>
            </div>
            <div class="panel-group">
                <label>Grupo Fila Atendimento</label>
                <table>
                    <tr>
                        <td><input type="checkbox" id="padrao" /> <label for="padrao">PADRÃO</label></td>
                    </tr>
                </table>
                <button onclick="refreshPanel()"><i class="fa fa-sync"></i></button>
            </div>
        </aside>
    </div>
    <script>
        function prevDay() {
            // Logic to go to the previous day
        }

        function nextDay() {
            // Logic to go to the next day
        }

        function prevMonth() {
            // Logic to go to the previous month
        }

        function nextMonth() {
            // Logic to go to the next month
        }

        function selectDate(date) {
            // Logic to select a date and refresh the slots
        }

        function applyFilters() {
            // Logic to apply filters based on selected options
        }

        function filterSlots() {
            // Logic to filter slots by patient name
        }

        function editSlot(slotId) {
            // Logic to edit a slot
        }

        function cancelSlot(slotId) {
            // Logic to cancel a slot
        }

        function attendSlot(slotId) {
            // Logic to mark a slot as attended
        }

        function toggleFreeOnly() {
            // Logic to toggle showing only free slots
        }

        function refreshPanel() {
            // Logic to refresh the right panel with updated data
        }
        // JS stubs: prevDay(), nextDay(), prevMonth(), nextMonth(), selectDate(), applyFilters(), filterSlots(), editSlot(), cancelSlot(), attendSlot(), refreshPanel()
    </script>
</body>

</html>